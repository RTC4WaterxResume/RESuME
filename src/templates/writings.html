<div class='container'>
<div class='view'>

<!-- <span class='btn-line-group'><button class='btn-line active' ng-click='save()'>{{isSaving? "saving...":"save"}}</button></span> -->


<div class="row">
  <div class='col-md-8'>
    <label>
      <span translate="field.label.title"></span>
    </label>
    <textarea id='draft-title' class='elastic-textarea' rows="1" msd-elastic ng-model='title'   type='text' placeholder='Untitled'></textarea>
    <label></label>
    <label>
      <span translate="field.label.abstract"></span>
    </label>
    <textarea id='draft-abstract' class='elastic-textarea' rows="1" msd-elastic ng-model='abstract' type='text' placeholder='abstract'></textarea>
    
    <label translate="drafts.keywords.placeholder"></label>
    <tags-input class='tags-input' on-tag-added='attachTag($tag)' on-tag-removed='detachTag($tag)' key-property='id' display-property='name' ng-model="keywords" add-from-autocomplete-only="true">
      <auto-complete source="suggestTags($query, {category:'keyword'})"></auto-complete>
    </tags-input>



  </div>
  <div class='col-md-4'>
    
    <div class='cover-preview-wrapper'>
      <label translate="field.label.cover"></label>
      <div class="cover-preview" ng-repeat="document in story.covers">
        <div ng-if='document.data'>
          <div lazy-img='{{document|coverage}}' class='lazy-box'></div>

          <div class='tile'>
            <div class='title' embedit='document.data.title' language='language'></div>
            <div class='copyright' embedit='document.data.copyright'></div>
            <div class='btn-line-group'>
              <button class='btn-line' ng-disabled='!story.covers.length' ng-click='
              removeCover(document)' translate="button.removecover"></button>
            </div>
          </div>
        </div>

      </div>
      <div class="center">
        <div class='btn-line-group ' style='width: 100%'>
          <button   class='btn-line' ng-click='
            openCoversModal()' translate="button.choosecover"></button>
        </div>
      </div>
    </div>
    
    <div ng-if='user.is_staff'>
      <!-- doi -->
      <label>
        <span translate="field.label.doi"></span>
      </label>
      <textarea class='elastic-textarea' rows="1" msd-elastic ng-model='story.metadata.doi' type='text' placeholder='doi'></textarea>

      <!-- citation -->
      <label>
        <span translate="field.label.reference"></span>
      </label>
      <textarea class='elastic-textarea' rows="1" msd-elastic ng-model='story.metadata.reference' type='text' placeholder='doi'></textarea>


      <!-- tags placeholder  -->
      <label translate="staff.drafts.tags.placeholder"></label>
      <tags-input class='tags-input'  on-tag-added='attachTag($tag)' on-tag-removed='detachTag($tag)' key-property='id' display-property='name' ng-model="displayedTags" add-from-autocomplete-only="true">
          <auto-complete source="suggestTags($query, {category__in:['blog','writing', 'highlights', 'publishing']})" ></auto-complete>
      </tags-input>
    </div>
  </div>
</div>


<div class='actions'>
  <!-- <div ng-if='metadata.owner.is_staff' class='btn-line-group'> -->
  
  <div class='btn-line-group' ng-if='!isDraft && id'>
    <button ng-if='!isCollection' class='btn-line' ui-sref="story({postId: story.slug})" translate="button.viewmode"></button>
    <button ng-if='isCollection' class='btn-line' ui-sref="collection({collectionId: story.slug})" translate="button.viewmode"></button>
  </div>
  
  <div class='btn-line-group primary'>
    <button ng-if='!isDraft' ng-click='save()' class='btn-line'><span ng-if='!isSaving' translate="button.save"></span><span ng-if='isSaving' translate="button.issaving"></span></button>
    <button ng-if='isDraft' ng-click='save()' class='btn-line'><span translate="button.create"></span></button>
    
  </div>
  <!-- </div> -->
  
</div>



<!-- <div class='authors' ng-if='!isDraft'>
by <a href>{{metadata.owner.username}}</a>
</div>
<div class='authors' ng-if='isDraft'>
  <div ng-if='user.username'>
    by <a href>{{user.username}}</a>
  </div>
  <div ng-if='!user.username'>
    by <a href>anonymous</a>
  </div>
</div> -->

<!-- <div ng-if='!isDraft'>
  <form class="form-inline">
    <div class="form-group">
      <label translate='date'></label>
      <input type="text" class="form-control" ng-model="date" name="date" data-max-date="today" timezone='UTC' bs-datepicker data-autoclose="1">{{date}}
    </div>
  </form>
</div> -->

</div>
</div>

<div class='fluid-container' style='padding: 0 50px 50px 100px; background: #efefef; overflow: hidden;'>
  <div class='row'>
    <div class='col-xs-6' id="draft-contents">
      
      <div style='min-height: 50px; position:relative'>
          <!-- <medium-editor ng-model='contents' bind-options="mediumOptions"></medium-editor> -->
          
          <div mde='contents' language='language' setdocs='setDocuments(documents)' setmarked='setMarked(marked)' settoc='setToC(items)'></div>
          
      </div>
    </div>
    <div class='col-xs-6' style='padding-left:0'>
      <div class='contents' id='contents' markdownit='marked' watchmarkdownit='true' watchlanguage='true' language='language' listener='listener(event, data, callback)'></div>
      <div rangy container='contents' highlights='story.highlights' commented='commented(error, comment)' target='story' actor='user' onCommentsSelected='commentsSelected(uids)'></div>
    </div>
  </div>
</div>



